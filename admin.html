<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ä¸Šå‚³ç®¡ç†å¾Œå° - å¯§å­¸æœƒäº†å—</title>
    <style>
        body { font-family: sans-serif; background: #f0f2f5; padding: 20px; line-height: 1.6; }
        .box { background: #fff; padding: 25px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); max-width: 900px; margin: 0 auto 30px; }
        h2 { margin-top: 0; color: #333; border-left: 5px solid #4361ee; padding-left: 10px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; }
        
        /* ç·¨è¼¯å™¨å·¥å…·åˆ— */
        .toolbar { background: #f8fafc; border: 1px solid #ddd; border-bottom: none; padding: 10px; border-radius: 8px 8px 0 0; display: flex; flex-wrap: wrap; gap: 5px; }
        .toolbar button { padding: 5px 10px; cursor: pointer; border: 1px solid #ccc; background: #fff; border-radius: 4px; }
        #editor { border: 1px solid #ddd; min-height: 300px; padding: 15px; border-radius: 0 0 8px 8px; outline: none; background: #fff; }
        
        button.main-btn { background: #4361ee; color: white; border: none; padding: 15px; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 20px; }
        .preview-img { width: 100%; max-height: 150px; object-fit: cover; border-radius: 8px; margin-top: 5px; border: 1px solid #eee; display: none; }
        .post-item { background: #fafafa; padding: 12px; border-radius: 8px; margin-top: 10px; border: 1px solid #eee; display: flex; justify-content: space-between; }
    </style>
</head>
<body>

<div class="box">
    <h2>ğŸ¨ ç¶²ç«™åŸºç¤è¨­å®š</h2>
    <div class="grid">
        <div><label>ç¶²ç«™åç¨±</label><input type="text" id="sn"></div>
        <div><label>ç¶²ç«™ Logo (é¸å–æª”æ¡ˆ)</label><input type="file" accept="image/*" onchange="uploadBase64(this, 'sl')"></div>
    </div>
    <button class="main-btn" onclick="saveSettings()">å„²å­˜è¨­å®š</button>
</div>

<div class="box">
    <h2>ğŸš€ ç™¼å¸ƒæ–°å…§å®¹</h2>
    <div class="grid">
        <div><label>é¡å‹</label><select id="p-type" onchange="toggleType()">
            <option value="image">åœ–æ–‡æ–‡ç« </option>
            <option value="video">å½±ç‰‡å…§å®¹</option>
        </select></div>
        <div><label>åˆ†é¡æ¨™ç±¤</label><input type="text" id="p-tag" placeholder="ä¾‹å¦‚ï¼šæ•™å­¸"></div>
    </div>
    <div style="margin-bottom:15px;"><label>å…§å®¹æ¨™é¡Œ</label><input type="text" id="p-title"></div>

    <div id="image-fields" class="grid">
        <div>
            <label>ğŸ–¼ï¸ å°é¢åœ–ç‰‡ (é¸å–æª”æ¡ˆ)</label>
            <input type="file" id="p-file" accept="image/*" onchange="uploadBase64(this, 'p-img-data', 'p-pre')">
            <img id="p-pre" class="preview-img">
        </div>
        <div><label>æ¨é€åˆ°è¼ªæ’­</label><select id="p-hero"><option value="0">å¦</option><option value="1">æ˜¯</option></select></div>
    </div>

    <div id="video-fields" style="display:none; margin-bottom:15px;">
        <label>å½±ç‰‡ç¶²å€ (YouTube æˆ– MP4)</label>
        <input type="text" id="p-video">
    </div>

    <label>å…§å®¹ç·¨è¼¯</label>
    <div class="toolbar">
        <button onclick="exec('bold')"><b>B</b></button>
        <button onclick="exec('formatBlock', 'h2')">æ¨™é¡Œ</button>
        <button onclick="exec('hiliteColor', 'yellow')">âœ¨ è¢å…‰</button>
        <button onclick="insertImage()">ğŸ“· æ’å…¥åœ–ç‰‡</button>
        <button onclick="exec('removeFormat')">ğŸ§¹ æ¸…é™¤æ ¼å¼</button>
    </div>
    <div id="editor" contenteditable="true">åœ¨é€™è£¡è¼¸å…¥å…§å®¹...</div>

    <button class="main-btn" style="background:#10b981;" onclick="addPost()">ç™¼å¸ƒæ–‡ç« </button>
</div>

<div class="box">
    <h2>ğŸ“‹ æ–‡ç« ç®¡ç†</h2>
    <div id="admin-post-list"></div>
</div>

<script>
    // å…¨åŸŸå„²å­˜åœ–ç‰‡ç·¨ç¢¼
    let tempImages = { sl: "", pImgData: "" };

    function exec(cmd, val = null) { document.execCommand(cmd, false, val); }

    // é—œéµåŠŸèƒ½ï¼šå°‡æª”æ¡ˆè½‰ç‚ºæ–‡å­—ç·¨ç¢¼
    function uploadBase64(input, target, previewId) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                const base64 = e.target.result;
                if (target === 'sl') localStorage.setItem('sl', base64);
                if (target === 'p-img-data') tempImages.pImgData = base64;
                if (previewId) {
                    const pre = document.getElementById(previewId);
                    pre.src = base64;
                    pre.style.display = 'block';
                }
            };
            reader.readAsDataURL(input.files[0]);
        }
    }

    // åœ¨ç·¨è¼¯å™¨å…§æ’å…¥åœ–ç‰‡
    function insertImage() {
        const input = document.createElement('input');
        input.type = 'file';
        input.accept = 'image/*';
        input.onchange = e => {
            const file = e.target.files[0];
            const reader = new FileReader();
            reader.onload = event => {
                exec('insertImage', event.target.result);
            };
            reader.readAsDataURL(file);
        };
        input.click();
    }

    function toggleType() {
        const t = document.getElementById('p-type').value;
        document.getElementById('image-fields').style.display = t === 'image' ? 'grid' : 'none';
        document.getElementById('video-fields').style.display = t === 'video' ? 'block' : 'none';
    }

    function saveSettings() {
        localStorage.setItem('sn', document.getElementById('sn').value);
        alert('è¨­å®šå„²å­˜æˆåŠŸï¼');
    }

    function addPost() {
        const posts = JSON.parse(localStorage.getItem('ps') || '[]');
        posts.unshift({
            type: document.getElementById('p-type').value,
            t: document.getElementById('p-title').value,
            tag: document.getElementById('p-tag').value || 'ä¸€èˆ¬',
            c: document.getElementById('editor').innerHTML,
            img: tempImages.pImgData, // å­˜å…¥ç·¨ç¢¼å¾Œçš„åœ–ç‰‡
            isHero: document.getElementById('p-hero').value === "1",
            video: document.getElementById('p-video').value
        });
        localStorage.setItem('ps', JSON.stringify(posts));
        alert('æ–‡ç« ç™¼å¸ƒæˆåŠŸï¼');
        location.reload();
    }

    function renderList() {
        const posts = JSON.parse(localStorage.getItem('ps') || '[]');
        document.getElementById('admin-post-list').innerHTML = posts.map((p, i) => `
            <div class="post-item">
                <span><b>[${p.tag}]</b> ${p.t}</span>
                <button style="background:red; color:white; border:none; padding:5px; cursor:pointer;" onclick="delPost(${i})">åˆªé™¤</button>
            </div>
        `).join('');
    }

    function delPost(i) {
        const posts = JSON.parse(localStorage.getItem('ps') || '[]');
        posts.splice(i, 1);
        localStorage.setItem('ps', JSON.stringify(posts));
        renderList();
    }

    window.onload = () => {
        if(localStorage.getItem('sn')) document.getElementById('sn').value = localStorage.getItem('sn');
        renderList();
    };
</script>
</body>
</html>